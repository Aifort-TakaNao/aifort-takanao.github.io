<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>リンク作成ツール</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

<style>
body{
  margin:0;
  font-family:"M PLUS Rounded 1c",sans-serif;
  background:url('https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=1200&q=80') no-repeat center/cover fixed;
}
.overlay{
  position:fixed; inset:0;
  background:rgba(255,255,255,.75);
  backdrop-filter:blur(2px);
}
.content{
  position:relative;
  max-width:600px;
  margin:3rem auto;
  padding:2rem 1rem;
}
h1,h2{ text-align:center; color:#c97c5d; }
.card{
  background:rgba(255,255,255,.9);
  border-radius:16px;
  padding:2rem;
  margin-bottom:2rem;
  border:2px solid #e2c6b3;
  box-shadow:0 4px 16px rgba(0,0,0,.1);
}
label{ font-weight:bold; display:block; margin-top:.6rem; }
input,textarea,select{
  width:100%; padding:.5rem; margin-bottom:1rem;
  border-radius:8px; border:1px solid #ccc; font-size:1rem;
}
.copy-button,.save-button{
  background:#e3a57c; color:#fff;
  padding:.5rem 1rem; border:none;
  border-radius:8px; font-weight:bold;
  cursor:pointer; margin:.3rem;
}
.copy-button:hover,.save-button:hover{ background:#c77b5a; }
canvas{ margin-top:1rem; }
.output-section{text-align:center;}
</style>
</head>

<body>
<div class="overlay"></div>

<div class="content">
<h1>リンク作成ツール</h1>

<div class="card">
  <label>名前</label>
  <input id="name">

  <label>PINコード</label>
  <input id="pin">

  <label>Wi-Fi ID</label>
  <input id="id">

  <label>Wi-Fiパスワード</label>
  <input id="pw">

  <label>有効期限</label>
  <input id="exp" type="date">

  <label>発行日</label>
  <input id="iss" type="date" readonly>

  <label>メッセージ</label>
  <textarea id="text">ご確認ありがとうございます！</textarea>

  <label>ギフト</label>
  <select id="gift">
    <option value="1">あり</option>
    <option value="0">なし</option>
  </select>

  <div id="giftLinkGroup">
    <label>ギフトリンク</label>
    <input id="link">
    <label>ギフト有効期限</label>
    <input id="gexp" type="date">
  </div>

  <div id="sorryGroup">
    <label>ギフト不可メッセージ</label>
    <input id="sorry" value="このギフトは現在ご利用いただけません。">
  </div>

  <label>表示言語</label>
  <select id="lang">
    <option value="jp">日本語</option>
    <option value="en">English</option>
  </select>
</div>

<div class="card output-section">
  <h2>生成されたURL</h2>
  <input id="fullUrl" readonly>
  <button class="copy-button" onclick="copyText('fullUrl')">URLをコピー</button>

  <h2>QRコード</h2>
  <canvas id="qrCanvas" width="200" height="200"></canvas><br>
  <button class="save-button" onclick="saveQR()">QRを保存</button>

  <h2>招待メッセージ</h2>
  <textarea id="inviteText" rows="5" readonly></textarea>
  <button class="copy-button" onclick="copyText('inviteText')">
    招待文をコピー
  </button>
</div>
</div>

<script>
/* === 要素取得（絶対に省略しない） === */
const el = id => document.getElementById(id);

const nameI  = el("name");
const pinI   = el("pin");
const idI    = el("id");
const pwI    = el("pw");
const expI   = el("exp");
const issI   = el("iss");
const textI  = el("text");
const giftI  = el("gift");
const linkI  = el("link");
const gexpI  = el("gexp");
const sorryI = el("sorry");
const langI  = el("lang");

const fullUrl = el("fullUrl");
const inviteText = el("inviteText");

/* === QR === */
const qr = new QRious({
  element: el("qrCanvas"),
  size: 200,
  value: ""
});

/* === util === */
function formatDate(v){
  if(!v) return "";
  const d = new Date(v);
  return isNaN(d) ? "" : d.toUTCString().split(" ").slice(0,4).join(" ");
}

/* === メイン処理 === */
function updateAll(){
  const params = new URLSearchParams({
    name: nameI.value,
    pin: pinI.value,
    id: idI.value,
    pw: pwI.value,
    exp: formatDate(expI.value),
    iss: formatDate(issI.value),
    text: textI.value,
    gift: giftI.value,
    link: linkI.value,
    gexp: formatDate(gexpI.value),
    sorry: sorryI.value,
    lang: langI.value
  });

  const url = `https://aifort-takanao.github.io/?${params.toString()}`;
  fullUrl.value = url;
  qr.value = url;

  const username = nameI.value || "there";
  inviteText.value =
`Hi, ${username} !
Get your invitation from here!
*Do not reply to this account.
${url}`;

  el("giftLinkGroup").style.display = giftI.value === "1" ? "block" : "none";
  el("sorryGroup").style.display    = giftI.value === "0" ? "block" : "none";
}

/* === コピー & 保存 === */
function copyText(id){
  const t = el(id);
  t.select();
  document.execCommand("copy");
  alert("コピーしました！");
}

function saveQR(){
  const a = document.createElement("a");
  a.download = "qr-code.png";
  a.href = el("qrCanvas").toDataURL("image/png");
  a.click();
}

/* === 初期化 === */
window.addEventListener("DOMContentLoaded",()=>{
  issI.value = new Date().toISOString().split("T")[0];
  updateAll();
  document.querySelectorAll("input,textarea,select")
    .forEach(e => e.addEventListener("input", updateAll));
});
</script>
</body>
</html>
